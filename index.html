<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" type="image/png" href="https://i.ibb.co/q42kpqz/PrimeDrop-Logo.png">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrimeDrop VIP Store</title>
</head>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;300;400;500;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                    },
                    colors: {
                        vip: {
                            dark: '#050505',
                            card: '#0f0f0f',
                            border: '#1f1f1f'
                        }
                    },
                    backgroundImage: {
                        'gold-text': 'linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c)',
                        'gold-card': 'linear-gradient(135deg, rgba(255,215,0,0.1) 0%, rgba(0,0,0,0) 100%)',
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            background-color: #000000; 
            color: #ffffff; 
            background-image: radial-gradient(circle at top center, #1a1a1a 0%, #000000 70%);
            min-height: 100vh;
        }
        .text-gold-gradient {
            background: linear-gradient(to right, #bf953f, #e3c472, #b38728, #aa771c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        .glass-nav {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .glass-card {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        .gold-glow:hover {
            border-color: rgba(212, 175, 55, 0.5);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.15);
        }
        .btn-gold {
            background: linear-gradient(to bottom right, #bf953f, #aa771c);
            color: black;
            font-weight: 600;
            text-shadow: 0 1px 0 rgba(255,255,255,0.4);
        }
        .btn-gold:hover { filter: brightness(1.1); }
        .selected-pill {
            background: #bf953f !important;
            color: black !important;
            border-color: #bf953f !important;
            font-weight: bold;
        }
        .size-btn.selected {
            background: #bf953f;
            color: black;
            border-color: #bf953f;
            font-weight: bold;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #111; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #bf953f; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        .modal-animate { animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        .input-group input:focus ~ label,
        .input-group input:not(:placeholder-shown) ~ label,
        .input-group textarea:focus ~ label,
        .input-group textarea:not(:placeholder-shown) ~ label,
        .input-group select:focus ~ label,
        .input-group select:not(:placeholder-shown) ~ label {
            top: -8px; font-size: 10px; color: #bf953f; background: #000; padding: 0 4px;
        }
    </style>
</head>
<body class="flex flex-col font-sans pb-20 md:pb-0">

    <!-- Navbar -->
    <nav class="fixed top-0 w-full z-50 glass-nav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 md:h-20">
                <div class="flex items-center gap-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <div class="w-8 h-8 md:w-10 md:h-10 rounded-full btn-gold flex items-center justify-center shadow-lg shadow-yellow-900/40">
                        <i class="fa-solid fa-crown text-sm md:text-lg"></i>
                    </div>
                    <div class="leading-tight">
                        <h1 class="text-xl md:text-2xl tracking-tighter text-white font-light">PRIME<span class="text-gold-gradient font-bold">DROP</span></h1>
                    </div>
                </div>
                <div class="hidden md:flex items-center bg-white/5 rounded-full px-4 py-2 border border-white/10 focus-within:border-yellow-600/50 transition-colors w-96">
                    <i class="fa-solid fa-search text-gray-500"></i>
                    <input type="text" id="searchInputDesktop" placeholder="Search (e.g. Watches)..." class="bg-transparent border-none outline-none text-sm ml-3 w-full text-white placeholder-gray-600" onkeyup="filterProducts(this.value)">
                </div>
                <div class="flex items-center gap-4">
                    <div class="hidden sm:block text-xs font-bold text-gray-500 tracking-wider">USD ($)</div>
                    
                    <!-- Live Status Indicator (Hidden by default) -->
                    <div id="liveStatus" class="hidden items-center gap-1 bg-red-500/10 px-2 py-1 rounded-full border border-red-500/20" title="Connection Status">
                        <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse" id="statusDot"></div>
                        <span class="text-[10px] text-red-400 font-bold" id="statusText">CONNECTING</span>
                    </div>

                    <div id="guestControls" class="flex items-center gap-3">
                        <button onclick="openLoginModal()" class="hidden md:block text-sm text-gray-400 hover:text-white transition">Login</button>
                        <button onclick="openSignupModal()" class="btn-gold px-5 py-1.5 rounded-full text-xs md:text-sm shadow-lg shadow-yellow-500/10 hover:shadow-yellow-500/30 transition-all transform hover:-translate-y-0.5">JOIN VIP</button>
                    </div>
                    <div id="authControls" class="hidden flex items-center gap-3"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Search -->
    <div class="md:hidden pt-20 px-4 pb-2">
        <div class="flex items-center bg-[#111] rounded-xl px-4 py-3 border border-white/5 focus-within:border-yellow-600/50">
            <i class="fa-solid fa-search text-gray-500"></i>
            <input type="text" id="searchInputMobile" placeholder="Search..." class="bg-transparent border-none outline-none text-sm ml-3 w-full text-white placeholder-gray-600" onkeyup="filterProducts(this.value)">
        </div>
    </div>

    <!-- Hero -->
    <div class="pt-4 md:pt-28 pb-6 px-4">
        <div class="max-w-7xl mx-auto rounded-[2rem] overflow-hidden relative min-h-[220px] md:h-80 bg-[#111] border border-white/5 flex items-center shadow-2xl group">
            <div class="absolute inset-0 opacity-40 bg-[url('https://images.unsplash.com/photo-1550953936-a60d03b0c960?q=80&w=2070&auto=format&fit=crop')] bg-cover bg-center transition-transform duration-1000 group-hover:scale-105"></div>
            <div class="absolute inset-0 bg-gradient-to-r from-black via-black/80 to-transparent"></div>
            <div class="relative z-10 px-6 md:px-16 w-full">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-yellow-500/30 bg-yellow-500/10 backdrop-blur-md mb-4">
                    <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                    <span class="text-[10px] md:text-xs font-bold text-yellow-500 tracking-widest uppercase">New Drops Live</span>
                </div>
                <h2 class="text-3xl md:text-6xl font-extrabold text-white mb-2 tracking-tight">LUXURY <br class="md:hidden"> <span class="text-gold-gradient">REDEFINED</span></h2>
                <button onclick="document.getElementById('categoryContainer').scrollIntoView({behavior: 'smooth'})" class="text-white text-xs md:text-sm border-b border-yellow-500 pb-1 hover:text-yellow-400 transition-colors">Explore Categories <i class="fa-solid fa-arrow-down ml-1 text-[10px]"></i></button>
            </div>
        </div>
    </div>

    <!-- Categories -->
    <div id="categoryContainer" class="max-w-7xl mx-auto px-4 mb-8 overflow-x-auto hide-scrollbar">
        <div id="categoriesList" class="flex gap-3 whitespace-nowrap pb-2"></div>
    </div>

    <!-- Products -->
    <main class="flex-grow max-w-7xl mx-auto px-4 w-full">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg md:text-2xl font-light text-white"><span id="currentCategoryTitle" class="font-bold text-white">All Products</span></h3>
        </div>
        
        <!-- Loading State -->
        <div id="loadingState" class="text-center py-20">
            <div class="w-10 h-10 border-4 border-yellow-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-500 text-sm">Synchronizing with Global Database...</p>
        </div>

        <!-- Error State (If DB Fails) -->
        <div id="errorState" class="hidden text-center py-20 bg-red-500/5 rounded-2xl border border-red-500/20 mx-4">
            <i class="fa-solid fa-triangle-exclamation text-4xl text-red-500 mb-4"></i>
            <h3 class="text-lg font-medium text-red-400">Connection Failed</h3>
            <p class="text-gray-500 text-sm mt-2">Cannot connect to Live Database.</p>
            <p class="text-gray-600 text-xs mt-1">Please check your internet or database permissions.</p>
        </div>

        <div id="emptyState" class="hidden flex flex-col items-center justify-center py-20 opacity-50">
            <i class="fa-solid fa-crown text-4xl text-gray-600 mb-4"></i>
            <h3 class="text-lg font-medium text-gray-300">No items found</h3>
            <p class="text-gray-600 text-sm">Be the first to add something.</p>
        </div>
        <div id="productGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6"></div>
    </main>

    <footer class="mt-20 border-t border-white/5 bg-black py-10 pb-24 md:pb-10 text-center">
        <p class="text-gray-600 text-xs">&copy; 2026 PrimeDrop VIP.</p>
    </footer>

    <!-- Mobile Nav -->
    <div class="md:hidden fixed bottom-0 w-full z-50 glass-nav border-t border-white/5 pb-safe">
        <div class="flex justify-around items-center h-16 px-2">
            <button onclick="window.scrollTo(0,0)" class="flex flex-col items-center justify-center w-full h-full text-yellow-500"><i class="fa-solid fa-house text-lg mb-1"></i><span class="text-[10px]">Home</span></button>
            <button onclick="document.getElementById('searchInputMobile').focus()" class="flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-white transition"><i class="fa-solid fa-search text-lg mb-1"></i><span class="text-[10px]">Search</span></button>
            <button onclick="handleProfileClick()" class="flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-white transition">
                <div class="relative"><i class="fa-regular fa-user text-lg mb-1"></i><span id="navDot" class="hidden absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"></span></div>
                <span class="text-[10px]">Account</span>
            </button>
        </div>
    </div>

    <!-- AUTH MODALS -->
    <div id="loginModal" class="fixed inset-0 z-[60] hidden bg-black/95 backdrop-blur-md flex items-end md:items-center justify-center sm:p-4">
        <div class="bg-[#111] w-full md:w-[400px] rounded-t-3xl md:rounded-3xl border border-white/10 p-8 modal-animate shadow-2xl relative">
            <button onclick="closeLoginModal()" class="absolute top-6 right-6 text-gray-500 hover:text-white"><i class="fa-solid fa-times text-lg"></i></button>
            <div class="mb-8"><h2 class="text-3xl font-bold text-white mb-2">Welcome Back</h2></div>
            <form onsubmit="handleLogin(event)" class="space-y-6">
                <div class="input-group relative"><input type="email" id="loginEmail" required class="w-full bg-transparent border border-gray-700 rounded-lg px-4 py-3.5 text-sm text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm peer-placeholder-shown:text-base pointer-events-none">Email</label></div>
                <div class="input-group relative"><input type="password" id="loginPass" required class="w-full bg-transparent border border-gray-700 rounded-lg px-4 py-3.5 text-sm text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm peer-placeholder-shown:text-base pointer-events-none">Password</label></div>
                <p id="loginError" class="hidden text-red-500 text-xs">Invalid credentials</p>
                <button type="submit" class="w-full btn-gold py-4 rounded-xl text-sm font-bold uppercase">Access Account</button>
            </form>
        </div>
    </div>

    <div id="signupModal" class="fixed inset-0 z-[60] hidden bg-black/95 backdrop-blur-md flex items-end md:items-center justify-center sm:p-4">
        <div class="bg-[#111] w-full md:w-[400px] rounded-t-3xl md:rounded-3xl border border-white/10 p-8 modal-animate shadow-2xl relative">
            <button onclick="closeSignupModal()" class="absolute top-6 right-6 text-gray-500 hover:text-white"><i class="fa-solid fa-times text-lg"></i></button>
            <div class="mb-8"><h2 class="text-2xl font-bold text-white mb-2">Join VIP</h2></div>
            <form onsubmit="handleSignup(event)" class="space-y-5">
                <div class="input-group relative"><input type="text" id="signupName" required class="w-full bg-transparent border border-gray-700 rounded-lg px-4 py-3.5 text-sm text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm peer-placeholder-shown:text-base pointer-events-none">Full Name</label></div>
                <div class="input-group relative"><input type="email" id="signupEmail" required class="w-full bg-transparent border border-gray-700 rounded-lg px-4 py-3.5 text-sm text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm peer-placeholder-shown:text-base pointer-events-none">Email</label></div>
                <div class="input-group relative"><input type="password" id="signupPass" required class="w-full bg-transparent border border-gray-700 rounded-lg px-4 py-3.5 text-sm text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm peer-placeholder-shown:text-base pointer-events-none">Password</label></div>
                <button type="submit" class="w-full btn-gold py-4 rounded-xl text-sm font-bold uppercase">Create Account</button>
            </form>
        </div>
    </div>

    <!-- ADD PRODUCT MODAL (with STATS) -->
    <div id="addModal" class="fixed inset-0 z-[60] hidden bg-black/95 backdrop-blur-md flex items-center justify-center p-4">
        <div class="bg-[#111] w-full max-w-lg rounded-2xl border border-white/10 flex flex-col max-h-[90vh] modal-animate shadow-2xl">
            <div class="flex justify-between items-center p-6 border-b border-white/5 bg-[#111] rounded-t-2xl z-10">
                <h2 class="text-xl font-bold text-white"><span class="text-gold-gradient">Admin</span> Dashboard</h2>
                <button onclick="closeAddModal()" class="text-gray-500 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>
            
            <div class="overflow-y-auto p-6 custom-scrollbar flex-1">
                <!-- STATS SECTION -->
                <div class="grid grid-cols-3 gap-3 mb-6">
                    <div class="bg-gray-900/50 border border-white/10 rounded-xl p-3 text-center">
                        <p class="text-[10px] text-gray-400 uppercase tracking-widest">Today</p>
                        <p id="statToday" class="text-xl font-bold text-white mt-1">0</p>
                    </div>
                    <div class="bg-gray-900/50 border border-white/10 rounded-xl p-3 text-center">
                        <p class="text-[10px] text-gray-400 uppercase tracking-widest">Month</p>
                        <p id="statMonth" class="text-xl font-bold text-gold-gradient mt-1">0</p>
                    </div>
                    <div class="bg-gray-900/50 border border-white/10 rounded-xl p-3 text-center">
                        <p class="text-[10px] text-gray-400 uppercase tracking-widest">All Time</p>
                        <p id="statTotal" class="text-xl font-bold text-white mt-1">0</p>
                    </div>
                </div>

                <form id="addProductForm" onsubmit="handleFormSubmit(event)" class="space-y-4">
                    <div class="input-group relative mt-1">
                        <select id="pCategory" required class="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-yellow-500 outline-none text-white peer appearance-none"></select>
                        <label class="absolute left-4 top-3.5 text-gray-500 text-sm px-1 pointer-events-none">Category</label>
                        <i class="fa-solid fa-chevron-down absolute right-4 top-4 text-gray-500 text-xs pointer-events-none"></i>
                    </div>
                    <div class="input-group relative"><input type="text" id="pTitle" required class="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-yellow-500 outline-none text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm px-1 pointer-events-none">Product Title</label></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="input-group relative"><input type="number" step="0.01" id="pPrice" required class="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-yellow-500 outline-none text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm px-1 pointer-events-none">Price</label></div>
                        <div class="input-group relative"><input type="number" step="0.01" id="pOldPrice" class="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-yellow-500 outline-none text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm px-1 pointer-events-none">Old Price</label></div>
                    </div>
                    <div class="input-group relative"><input type="text" id="pSizes" class="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-yellow-500 outline-none text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm px-1 pointer-events-none">Sizes (S, M, L)</label></div>
                    <div class="border-2 border-dashed border-white/10 rounded-xl p-4 text-center hover:border-yellow-500/50 transition">
                        <p class="text-sm text-gray-400 mb-2">Upload Photos & Videos</p>
                        <div class="flex gap-2 justify-center mb-2">
                            <label class="cursor-pointer bg-gray-800 px-3 py-1 rounded text-xs hover:bg-gray-700"><i class="fa-solid fa-image mr-1"></i> Photos
                                <input type="file" id="multiImageInput" accept="image/*" multiple class="hidden" onchange="handleMultiFiles(this, 'image')">
                            </label>
                            <label class="cursor-pointer bg-gray-800 px-3 py-1 rounded text-xs hover:bg-gray-700"><i class="fa-solid fa-video mr-1"></i> Videos
                                <input type="file" id="multiVideoInput" accept="video/*" multiple class="hidden" onchange="handleMultiFiles(this, 'video')">
                            </label>
                        </div>
                        <div id="mediaPreviewList" class="flex flex-wrap gap-2 mt-2 justify-center empty:hidden"></div>
                    </div>
                    <div class="input-group relative"><input type="url" id="pLink" required class="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-yellow-500 outline-none text-white peer" placeholder=" "><label class="absolute left-4 top-3.5 text-gray-500 text-sm px-1 pointer-events-none">Affiliate Link</label></div>
                    <div class="input-group relative"><textarea id="pDesc" rows="2" class="w-full bg-[#1a1a1a] border border-white/10 rounded-lg px-4 py-3 text-sm focus:border-yellow-500 outline-none text-white peer" placeholder=" "></textarea><label class="absolute left-4 top-3.5 text-gray-500 text-sm px-1 pointer-events-none">Description</label></div>
                </form>
            </div>
            <div class="p-6 border-t border-white/5 bg-[#111] rounded-b-2xl z-10 mt-auto">
                <button id="publishBtn" type="submit" form="addProductForm" class="w-full btn-gold text-black font-bold py-3 rounded-xl transition shadow-lg shadow-yellow-900/20 hover:scale-[1.02]"><i class="fa-solid fa-paper-plane mr-2"></i> Publish Product</button>
            </div>
        </div>
    </div>

    <!-- VIEW MODAL -->
    <div id="viewModal" class="fixed inset-0 z-[70] hidden bg-black/98 backdrop-blur-xl flex items-center justify-center p-0 md:p-4">
        <div class="bg-[#050505] w-full md:max-w-4xl h-full md:h-auto md:rounded-3xl border-0 md:border border-white/10 overflow-hidden modal-animate flex flex-col md:flex-row relative">
            <button onclick="closeViewModal()" class="absolute top-4 right-4 z-20 w-10 h-10 bg-black/50 backdrop-blur rounded-full flex items-center justify-center text-white hover:bg-white/20 transition"><i class="fa-solid fa-times"></i></button>
            <div class="w-full md:w-1/2 h-[45vh] md:h-[500px] bg-[#111] flex items-center justify-center relative group">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-white/5 to-transparent"></div>
                <div id="sliderDisplay" class="w-full h-full flex items-center justify-center relative z-10"></div>
                <button onclick="changeSlide(-1)" class="absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-black/50 text-white rounded-full flex items-center justify-center hover:bg-gold z-20"><i class="fa-solid fa-chevron-left"></i></button>
                <button onclick="changeSlide(1)" class="absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-black/50 text-white rounded-full flex items-center justify-center hover:bg-gold z-20"><i class="fa-solid fa-chevron-right"></i></button>
                <div id="sliderDots" class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-1 z-20"></div>
            </div>
            <div class="w-full md:w-1/2 p-6 md:p-10 flex flex-col h-full overflow-y-auto">
                <div class="mb-auto">
                    <span id="mCategoryBadge" class="bg-white/10 text-gray-300 text-[10px] font-bold px-3 py-1 rounded-full uppercase tracking-wider">Category</span>
                    <h2 id="mTitle" class="text-2xl md:text-3xl font-light text-white mb-2 mt-2 leading-tight"></h2>
                    <div class="flex items-baseline gap-3 mb-4"><span id="mPrice" class="text-3xl font-bold text-gold-gradient"></span><span id="mOldPrice" class="text-sm text-gray-600 line-through"></span></div>
                    <div id="mSizesContainer" class="hidden mb-6"><p class="text-xs text-gray-500 uppercase tracking-widest mb-2">Select Size</p><div id="mSizesList" class="flex flex-wrap gap-2"></div></div>
                    <p id="mDesc" class="text-gray-400 text-sm leading-relaxed mb-8 font-light"></p>
                </div>
                <a id="mLink" href="#" target="_blank" class="w-full btn-gold text-black font-bold text-base py-4 rounded-xl flex items-center justify-center gap-2 hover:scale-[1.02] shadow-2xl"><span>Purchase Now</span> <i class="fa-solid fa-arrow-up-right-from-square text-xs"></i></a>
            </div>
        </div>
    </div>

    <script type="module">
        // --- FIREBASE SETUP ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, doc, getDoc, getDocs, setDoc, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";

        // Use the config provided by user
        const userFirebaseConfig = {
            apiKey: "AIzaSyCta8jzYrib54xK4SXJ7oLlVp1_LBLRFHg",
            authDomain: "primedropvip.firebaseapp.com",
            projectId: "primedropvip",
            storageBucket: "primedropvip.firebasestorage.app",
            messagingSenderId: "581115848208",
            appId: "1:581115848208:web:ea566faec4c92035b7cc95",
            measurementId: "G-YJLF3C9VNG"
        };

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : userFirebaseConfig;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'primedropvip'; // Ensure this matches projectId

        let db, auth, products = [];
        let isUsingFirebase = false;
        
        // Initialize Firebase - STRICT MODE
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
            isUsingFirebase = true;
            
            const initAuth = async () => {
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (e) {
                    console.error("Auth Failed:", e);
                    document.getElementById('loadingState').innerHTML = `<p class='text-red-500 font-bold'>Auth Error: ${e.message}</p>`;
                }
            };
            
            initAuth();

            onAuthStateChanged(auth, (user) => {
                const q = collection(db, 'artifacts', appId, 'public', 'data', 'products');
                onSnapshot(q, (snapshot) => {
                    products = snapshot.docs.map(d => ({id: d.id, ...d.data()}));
                    products.sort((a, b) => {
                        const dateA = a.createdAt && a.createdAt.toDate ? a.createdAt.toDate() : (a.createdAt ? new Date(a.createdAt) : new Date(0));
                        const dateB = b.createdAt && b.createdAt.toDate ? b.createdAt.toDate() : (b.createdAt ? new Date(b.createdAt) : new Date(0));
                        return dateB - dateA; 
                    });
                    
                    updateConnectionStatus(true);
                    renderProducts(document.getElementById('searchInputDesktop').value);
                }, (error) => {
                    console.warn("Live Data Error:", error.message);
                    updateConnectionStatus(false);
                    // Show error state instead of local storage
                    document.getElementById('productGrid').innerHTML = "";
                    document.getElementById('errorState').classList.remove('hidden');
                    document.getElementById('loadingState').classList.add('hidden');
                });
            });

        } catch (err) {
            console.error("Critical Firebase Error:", err);
            updateConnectionStatus(false);
        }

        function updateConnectionStatus(isLive) {
            document.getElementById('loadingState').classList.add('hidden');
            const liveStatusEl = document.getElementById('liveStatus');
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');

            if(!currentUser || !currentUser.isAdmin) {
                liveStatusEl.classList.add('hidden');
                return;
            } else {
                liveStatusEl.classList.remove('hidden');
            }

            if(isLive) {
                statusDot.className = "w-2 h-2 rounded-full bg-green-500 animate-pulse";
                liveStatusEl.className = "flex items-center gap-1 bg-green-500/10 px-2 py-1 rounded-full border border-green-500/20";
                statusText.innerText = "LIVE";
                statusText.className = "text-[10px] text-green-400 font-bold";
                document.getElementById('errorState').classList.add('hidden');
            } else {
                statusDot.className = "w-2 h-2 rounded-full bg-red-500";
                liveStatusEl.className = "flex items-center gap-1 bg-red-500/10 px-2 py-1 rounded-full border border-red-500/20";
                statusText.innerText = "OFFLINE (Permission)";
                statusText.className = "text-[10px] text-red-400 font-bold";
            }
        }

        // --- APP LOGIC ---
        const CATEGORIES = ["Home Appliances","Computer & Office","Home Improvement","Home & Garden","Sports & Entertainment","Office & School Supplies","Toys & Hobbies","Security & Protection","Automobiles, Parts & Accessories","Jewelry & Accessories","Lights & Lighting","Consumer Electronics","Beauty & Health","Weddings & Events","Shoes","Electronic Components & Supplies","Phones & Telecommunications","Tools","Mother & Kids","Furniture","Watches","Luggage & Bags","Underwear","Virtual Products","Industrial & Business","Sports Shoes,Clothing&Accessories","Phones & Telecommunications Accessories","Women's Clothing","Men's Clothing","Apparel Accessories","Hair Extensions & Wigs","Special Category","Books & Cultural Merchandise","Novelty & Special Use","Motorcycle Equipments & Parts"];
        
        let currentCategory = "All";
        const ADMIN_EMAIL = "Haideroffical16@gmail.com";
        const ADMIN_PASS = "HaiderAli000";
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        
        let tempMedia = [];
        let currentProductMedia = [];
        let currentSlideIndex = 0;

        window.onload = function() {
            renderCategories();
            populateAdminCategories();
            updateUI();
            trackVisit(); 
        };

        // --- VISITOR TRACKING LOGIC ---
        async function trackVisit() {
            if (sessionStorage.getItem('visited_today')) return;
            sessionStorage.setItem('visited_today', 'true');
            const today = new Date().toISOString().split('T')[0];

            if (isUsingFirebase) {
                try {
                    const statsRef = doc(db, 'artifacts', appId, 'public', 'data', 'stats', today);
                    const docSnap = await getDoc(statsRef);
                    if (docSnap.exists()) {
                        await setDoc(statsRef, { count: docSnap.data().count + 1 }, { merge: true });
                    } else {
                        await setDoc(statsRef, { count: 1 });
                    }
                } catch (e) {
                    console.warn("Stats Write Error (Likely Permission):", e.code);
                }
            }
        }

        async function loadStats() {
            let todayCount = 0, monthCount = 0, totalCount = 0;
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = today.substring(0, 7);

            if (isUsingFirebase) {
                try {
                    const statsCol = collection(db, 'artifacts', appId, 'public', 'data', 'stats');
                    const snapshot = await getDocs(statsCol);
                    snapshot.forEach(doc => {
                        const date = doc.id;
                        const count = doc.data().count || 0;
                        totalCount += count;
                        if (date === today) todayCount = count;
                        if (date.startsWith(currentMonth)) monthCount += count;
                    });
                    
                    document.getElementById('statToday').innerText = todayCount;
                    document.getElementById('statMonth').innerText = monthCount;
                    document.getElementById('statTotal').innerText = totalCount;
                } catch (e) { 
                    console.warn("Stats Read Error:", e);
                }
            }
        }

        // --- Renders ---
        function renderCategories() {
            const list = document.getElementById('categoriesList');
            let html = `<button onclick="filterByCategory('All')" id="cat-All" class="selected-pill bg-white/10 text-white px-5 py-2 rounded-full text-xs font-medium border border-white/10 hover:bg-white/20 transition">All Categories</button>`;
            CATEGORIES.forEach(cat => {
                const id = cat.replace(/[^a-zA-Z0-9]/g, '');
                const safeCat = cat.replace(/'/g, "\\'");
                html += `<button onclick="filterByCategory('${safeCat}')" id="cat-${id}" class="bg-black/50 text-gray-400 px-5 py-2 rounded-full text-xs font-medium border border-white/5 hover:text-white hover:border-white/20 transition">${cat}</button>`;
            });
            list.innerHTML = html;
        }

        function populateAdminCategories() {
            const select = document.getElementById('pCategory');
            select.innerHTML = `<option value="" disabled selected>Select Category...</option>`;
            CATEGORIES.forEach(cat => { select.innerHTML += `<option value="${cat}">${cat}</option>`; });
        }

        window.filterByCategory = function(cat) {
            currentCategory = cat;
            document.querySelectorAll('#categoriesList button').forEach(b => {
                b.classList.remove('selected-pill', 'text-black');
                b.classList.add('text-gray-400', 'bg-black/50');
            });
            const safeId = cat === 'All' ? 'All' : cat.replace(/[^a-zA-Z0-9]/g, '');
            const btn = document.getElementById(`cat-${safeId}`);
            if(btn) { btn.classList.add('selected-pill'); btn.classList.remove('text-gray-400', 'bg-black/50'); }
            document.getElementById('currentCategoryTitle').innerText = cat === 'All' ? 'All Products' : cat;
            renderProducts(document.getElementById('searchInputDesktop').value);
        }

        window.renderProducts = function(filterText = "") {
            const grid = document.getElementById('productGrid');
            const emptyState = document.getElementById('emptyState');
            if(!grid) return;
            grid.innerHTML = "";
            
            const terms = filterText.toLowerCase().split(/\s+/).filter(t => t.length > 0);
            
            let filtered = products.filter(p => {
                const text = (p.title + " " + (p.description||"") + " " + (p.category||"")).toLowerCase();
                if(terms.length === 0) return true;
                return terms.every(term => text.includes(term));
            });

            if (currentCategory !== "All") {
                filtered = filtered.filter(p => p.category === currentCategory);
            }

            if (filtered.length === 0) {
                emptyState.classList.remove('hidden');
                document.getElementById('errorState').classList.add('hidden'); // Hide error if no products but connection ok
            } else {
                emptyState.classList.add('hidden');
                filtered.forEach(product => {
                    const deleteBtn = (currentUser && currentUser.isAdmin) ? `<button onclick="deleteProduct('${product.id}')" class="absolute top-3 right-3 bg-red-500/90 text-white w-8 h-8 rounded-full shadow-lg z-20 flex items-center justify-center hover:bg-red-600"><i class="fa-solid fa-trash text-xs"></i></button>` : '';
                    
                    const mainImage = (product.media && product.media.length > 0 && product.media[0].type === 'image') ? product.media[0].src : 'https://placehold.co/400x500/111/gold?text=No+Image';
                    
                    const card = `
                        <div class="glass-card rounded-2xl overflow-hidden relative group cursor-pointer gold-glow transition-all duration-300">
                            <div onclick="openViewModal('${product.id}')">
                                <div class="relative aspect-[4/5] bg-[#0a0a0a] overflow-hidden p-6 flex items-center justify-center">
                                    <img src="${mainImage}" class="w-full h-full object-contain opacity-90 group-hover:opacity-100 group-hover:scale-110 transition-transform duration-500">
                                    <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-[2px]">
                                        <span class="bg-white/10 backdrop-blur text-white px-4 py-2 rounded-full text-xs font-medium border border-white/20">View Details</span>
                                    </div>
                                </div>
                                <div class="p-4 bg-gradient-to-b from-[#151515] to-[#0f0f0f]">
                                    <div class="text-[10px] text-gray-500 uppercase tracking-wide mb-1 truncate">${product.category || 'General'}</div>
                                    <h3 class="text-gray-300 font-light text-xs md:text-sm line-clamp-1 mb-1">${product.title}</h3>
                                    <div class="flex items-center justify-between">
                                        <p class="text-gold-gradient font-bold text-sm md:text-lg">$${parseFloat(product.price).toLocaleString()}</p>
                                    </div>
                                </div>
                            </div>
                            ${deleteBtn}
                        </div>
                    `;
                    grid.innerHTML += card;
                });
            }
        }

        // --- Data Handling ---
        window.handleMultiFiles = function(input, type) {
            const files = Array.from(input.files);
            if(files.length === 0) return;
            files.forEach(file => {
                if(file.size > 800 * 1024) { alert(`File ${file.name} too large. Use compressed images.`); return; }
                const reader = new FileReader();
                reader.onload = function(e) {
                    tempMedia.push({ type: type, src: e.target.result });
                    renderMediaPreview();
                };
                reader.readAsDataURL(file);
            });
        }

        window.renderMediaPreview = function() {
            const container = document.getElementById('mediaPreviewList');
            container.innerHTML = "";
            tempMedia.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = "w-16 h-16 rounded border border-white/20 relative overflow-hidden group";
                let content = item.type === 'image' ? `<img src="${item.src}" class="w-full h-full object-cover">` : `<video src="${item.src}" class="w-full h-full object-cover"></video><i class="fa-solid fa-play absolute inset-0 m-auto text-white drop-shadow-md"></i>`;
                div.innerHTML = `${content}<button type="button" onclick="removeMedia(${index})" class="absolute top-0 right-0 bg-red-600 text-white w-4 h-4 text-[10px] flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-times"></i></button>`;
                container.appendChild(div);
            });
        }

        window.removeMedia = function(index) {
            tempMedia.splice(index, 1);
            renderMediaPreview();
        }

        window.handleFormSubmit = async function(e) {
            e.preventDefault();
            const btn = document.getElementById('publishBtn');
            btn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Uploading...`;
            btn.disabled = true;

            if(tempMedia.length === 0) tempMedia.push({type: 'image', src: 'https://placehold.co/400x500/111/gold?text=No+Image'});

            const sizeStr = document.getElementById('pSizes').value.trim();
            const productData = {
                title: document.getElementById('pTitle').value,
                category: document.getElementById('pCategory').value,
                price: document.getElementById('pPrice').value,
                oldPrice: document.getElementById('pOldPrice').value,
                link: document.getElementById('pLink').value,
                description: document.getElementById('pDesc').value,
                sizes: sizeStr ? sizeStr.split(',').map(s=>s.trim()).filter(s=>s) : [],
                media: tempMedia,
                createdAt: serverTimestamp ? serverTimestamp() : new Date().toISOString()
            };

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'products'), productData);
                closeAddModal();
                e.target.reset();
                tempMedia = [];
                renderMediaPreview();
            } catch (err) {
                alert("Upload failed: Permission Denied by Database Rules.");
            } finally {
                btn.innerHTML = `<i class="fa-solid fa-paper-plane mr-2"></i> Publish Product`;
                btn.disabled = false;
            }
        }

        window.deleteProduct = async function(id) {
            if(!confirm("Delete item?")) return;
            try {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', id));
            } catch(e) { alert("Delete failed: Permission Denied."); }
        }

        // --- Modals & Sliders ---
        window.openViewModal = function(id) {
            const product = products.find(p => p.id === id);
            if(!product) return;

            document.getElementById('mTitle').innerText = product.title;
            document.getElementById('mCategoryBadge').innerText = product.category || 'General';
            document.getElementById('mPrice').innerText = "$" + parseFloat(product.price).toLocaleString();
            document.getElementById('mOldPrice').innerText = "$" + parseFloat(product.oldPrice).toLocaleString();
            document.getElementById('mDesc').innerText = product.description;
            document.getElementById('mLink').href = product.link;

            const sContainer = document.getElementById('mSizesContainer');
            const sList = document.getElementById('mSizesList');
            sList.innerHTML = '';
            if(product.sizes && product.sizes.length > 0) {
                sContainer.classList.remove('hidden');
                product.sizes.forEach(s => sList.innerHTML += `<button class="size-btn w-10 h-10 rounded border border-white/20 text-gray-400 hover:border-yellow-500 hover:text-white transition">${s}</button>`);
            } else { sContainer.classList.add('hidden'); }

            currentProductMedia = product.media || [{type:'image', src: product.image}];
            currentSlideIndex = 0;
            renderSlider();
            document.getElementById('viewModal').classList.remove('hidden');
        }

        window.renderSlider = function() {
            const display = document.getElementById('sliderDisplay');
            const dots = document.getElementById('sliderDots');
            const media = currentProductMedia[currentSlideIndex];
            
            if(media.type === 'image') display.innerHTML = `<img src="${media.src}" class="max-h-full max-w-full object-contain drop-shadow-2xl modal-animate">`;
            else display.innerHTML = `<video controls autoplay class="max-h-full max-w-full object-contain drop-shadow-2xl modal-animate"><source src="${media.src}"></video>`;

            if(currentProductMedia.length > 1) {
                let dotsHtml = '';
                currentProductMedia.forEach((_, idx) => {
                    dotsHtml += `<div class="${idx === currentSlideIndex ? 'bg-yellow-500 w-6' : 'bg-gray-600 w-2'} h-1 rounded-full transition-all duration-300"></div>`;
                });
                dots.innerHTML = dotsHtml;
            } else { dots.innerHTML = ''; }
        }

        window.changeSlide = function(dir) {
            if(currentProductMedia.length <= 1) return;
            currentSlideIndex += dir;
            if(currentSlideIndex < 0) currentSlideIndex = currentProductMedia.length - 1;
            if(currentSlideIndex >= currentProductMedia.length) currentSlideIndex = 0;
            renderSlider();
        }

        // --- Auth & Utils ---
        window.handleLogin = function(e){
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const pass = document.getElementById('loginPass').value.trim();
            if(email===ADMIN_EMAIL.toLowerCase() && pass===ADMIN_PASS) {
                currentUser={name:"Admin", email:ADMIN_EMAIL, isAdmin:true};
            } else {
                const u = (JSON.parse(localStorage.getItem('vipUsers'))||[]).find(x=>x.email.toLowerCase()===email && x.pass===pass);
                if(u) currentUser={name:u.name, email:u.email, isAdmin:false};
                else return document.getElementById('loginError').classList.remove('hidden');
            }
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            closeLoginModal(); updateUI();
        }

        window.handleSignup = function(e){
            e.preventDefault();
            const n=document.getElementById("signupName").value, m=document.getElementById("signupEmail").value, p=document.getElementById("signupPass").value;
            let u=JSON.parse(localStorage.getItem('vipUsers'))||[];
            if(u.find(x=>x.email===m)) return alert("Exists");
            u.push({name:n, email:m, pass:p});
            localStorage.setItem('vipUsers', JSON.stringify(u));
            currentUser={name:n, email:m, isAdmin:false};
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            closeSignupModal(); updateUI();
        }

        window.logoutUser = function(){ currentUser = null; localStorage.removeItem('currentUser'); updateUI(); }
        
        window.updateUI = function(){
            const g=document.getElementById('guestControls'), a=document.getElementById('authControls');
            const statusIndicator = document.getElementById('liveStatus');

            if(!currentUser) { 
                g.classList.remove('hidden'); 
                a.classList.add('hidden'); 
                if(statusIndicator) statusIndicator.classList.add('hidden'); 
            }
            else {
                g.classList.add('hidden'); a.classList.remove('hidden'); a.classList.add('flex');
                if(currentUser.isAdmin) {
                    a.innerHTML = `<span class="hidden lg:inline text-[10px] text-green-400 font-bold border border-green-500/20 px-2 py-1 rounded">ADMIN</span><button onclick="openAddModal()" class="btn-gold w-8 h-8 flex items-center justify-center rounded-lg shadow-lg text-black"><i class="fa-solid fa-plus"></i></button><button onclick="logoutUser()" class="w-8 h-8 rounded-lg bg-red-500/10 flex items-center justify-center text-red-400 border border-red-500/20"><i class="fa-solid fa-power-off"></i></button>`;
                    if(statusIndicator) statusIndicator.classList.remove('hidden'); 
                }
                else {
                    a.innerHTML = `<div class="w-8 h-8 rounded-full bg-yellow-700 flex items-center justify-center text-xs font-bold text-white">${currentUser.name[0]}</div><button onclick="logoutUser()" class="text-xs text-gray-500 hover:text-white">Logout</button>`;
                    if(statusIndicator) statusIndicator.classList.add('hidden'); 
                }
            }
            renderProducts(document.getElementById('searchInputDesktop').value);
        }

        window.handleProfileClick = function() { if(!currentUser) openLoginModal(); else if(currentUser.isAdmin) openAddModal(); else alert("Logged in: "+currentUser.name); }
        window.openLoginModal = () => document.getElementById('loginModal').classList.remove('hidden');
        window.closeLoginModal = () => document.getElementById('loginModal').classList.add('hidden');
        window.openSignupModal = () => document.getElementById('signupModal').classList.remove('hidden');
        window.closeSignupModal = () => document.getElementById('signupModal').classList.add('hidden');
        window.openAddModal = () => { 
            document.getElementById('addModal').classList.remove('hidden'); 
            tempMedia = []; renderMediaPreview();
            loadStats(); 
        };
        window.closeAddModal = () => document.getElementById('addModal').classList.add('hidden');
        window.closeViewModal = () => document.getElementById('viewModal').classList.add('hidden');
        window.onclick = (e) => ["viewModal","addModal","loginModal","signupModal"].forEach(id=>{ if(e.target.id===id) document.getElementById(id).classList.add('hidden'); });
    </script>
</body>
</html>
